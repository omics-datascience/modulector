version: '3'

services:
    # PostgreSQL
    db:
        image: omicsdatascience/modulector-db:1.4
        #volumes:
          # If you want to use a optimized postgres config, please uncomment the next line
          # with your path to postgres.conf file
          #- [your-local-path-to-postgresql.conf]:/var/lib/postgresql-static/postgresql.conf
          #
          # For example:
          #- ./db/postgres.conf:/var/lib/postgresql-static/postgresql.conf

    # Django Proxy Server
    nginx:
        image: nginx:1.19
        ports:
            - 80:8000
        volumes:
            - ./:/src
            - ./config/nginx/conf.d:/etc/nginx/conf.d
            - ./static:/static
        depends_on:
            - web

    # Django Backend Server
    web:
        image: omicsdatascience/modulector:1.4
        depends_on:
            - db
        environment:
            # Django
            DJANGO_SETTINGS_MODULE: 'ModulectorBackend.settings_prod'
            POSTGRES_HOST: 'db' # Name of the modulector-db service previously defined
